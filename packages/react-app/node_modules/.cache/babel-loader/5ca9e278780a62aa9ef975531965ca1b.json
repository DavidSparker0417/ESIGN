{"ast":null,"code":"import { jsx as _jsx, Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { useEffect, useState } from 'react';\nimport { getChainById } from '../helpers';\nimport { useEthers } from '../hooks';\nimport { useBlockNumber } from './blockNumber/blockNumber';\nimport { useConfig, useUpdateConfig } from './config';\nimport multicallABI from '../constants/abi/MultiCall.json';\nimport { deployContract } from '../helpers/contract';\nvar LocalMulticallState;\n\n(function (LocalMulticallState) {\n  LocalMulticallState[LocalMulticallState[\"Unknown\"] = 0] = \"Unknown\";\n  LocalMulticallState[LocalMulticallState[\"NonLocal\"] = 1] = \"NonLocal\";\n  LocalMulticallState[LocalMulticallState[\"Deploying\"] = 2] = \"Deploying\";\n  LocalMulticallState[LocalMulticallState[\"Deployed\"] = 3] = \"Deployed\";\n  LocalMulticallState[LocalMulticallState[\"Error\"] = 4] = \"Error\";\n})(LocalMulticallState || (LocalMulticallState = {}));\n\nexport function LocalMulticallProvider(_ref) {\n  let {\n    children\n  } = _ref;\n  const updateConfig = useUpdateConfig();\n  const {\n    multicallAddresses\n  } = useConfig();\n  const {\n    library,\n    chainId\n  } = useEthers();\n  const [localMulticallState, setLocalMulticallState] = useState(LocalMulticallState.Unknown);\n  const [multicallBlockNumber, setMulticallBlockNumber] = useState();\n  const blockNumber = useBlockNumber();\n  useEffect(() => {\n    var _a;\n\n    if (!library || !chainId) {\n      setLocalMulticallState(LocalMulticallState.Unknown);\n    } else if (!((_a = getChainById(chainId)) === null || _a === void 0 ? void 0 : _a.isLocalChain)) {\n      setLocalMulticallState(LocalMulticallState.NonLocal);\n    } else if (multicallAddresses && multicallAddresses[chainId]) {\n      setLocalMulticallState(LocalMulticallState.Deployed);\n    } else if (localMulticallState !== LocalMulticallState.Deploying) {\n      const signer = library.getSigner();\n\n      if (!signer) {\n        setLocalMulticallState(LocalMulticallState.Error);\n        return;\n      }\n\n      setLocalMulticallState(LocalMulticallState.Deploying);\n\n      const deployMulticall = async () => {\n        try {\n          const {\n            contractAddress,\n            blockNumber\n          } = await deployContract(multicallABI, signer);\n          updateConfig({\n            multicallAddresses: {\n              [chainId]: contractAddress\n            }\n          });\n          setMulticallBlockNumber(blockNumber);\n          setLocalMulticallState(LocalMulticallState.Deployed);\n        } catch (_a) {\n          setLocalMulticallState(LocalMulticallState.Error);\n        }\n      };\n\n      deployMulticall();\n    }\n  }, [library, chainId]);\n  const awaitingMulticallBlock = multicallBlockNumber && blockNumber && blockNumber < multicallBlockNumber;\n\n  if (localMulticallState === LocalMulticallState.Deploying || localMulticallState === LocalMulticallState.Deployed && awaitingMulticallBlock) {\n    return _jsx(\"div\", {\n      children: \"Deploying multicall...\"\n    });\n  } else if (localMulticallState === LocalMulticallState.Error) {\n    return _jsx(\"div\", {\n      children: \"Error deploying multicall contract\"\n    });\n  } else {\n    return _jsx(_Fragment, {\n      children: children\n    });\n  }\n}","map":{"version":3,"sources":["../../../../src/providers/LocalMulticallProvider.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { jsx as _jsx, Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { useEffect, useState } from 'react';\nimport { getChainById } from '../helpers';\nimport { useEthers } from '../hooks';\nimport { useBlockNumber } from './blockNumber/blockNumber';\nimport { useConfig, useUpdateConfig } from './config';\nimport multicallABI from '../constants/abi/MultiCall.json';\nimport { deployContract } from '../helpers/contract';\nvar LocalMulticallState;\n(function (LocalMulticallState) {\n    LocalMulticallState[LocalMulticallState[\"Unknown\"] = 0] = \"Unknown\";\n    LocalMulticallState[LocalMulticallState[\"NonLocal\"] = 1] = \"NonLocal\";\n    LocalMulticallState[LocalMulticallState[\"Deploying\"] = 2] = \"Deploying\";\n    LocalMulticallState[LocalMulticallState[\"Deployed\"] = 3] = \"Deployed\";\n    LocalMulticallState[LocalMulticallState[\"Error\"] = 4] = \"Error\";\n})(LocalMulticallState || (LocalMulticallState = {}));\nexport function LocalMulticallProvider({ children }) {\n    const updateConfig = useUpdateConfig();\n    const { multicallAddresses } = useConfig();\n    const { library, chainId } = useEthers();\n    const [localMulticallState, setLocalMulticallState] = useState(LocalMulticallState.Unknown);\n    const [multicallBlockNumber, setMulticallBlockNumber] = useState();\n    const blockNumber = useBlockNumber();\n    useEffect(() => {\n        var _a;\n        if (!library || !chainId) {\n            setLocalMulticallState(LocalMulticallState.Unknown);\n        }\n        else if (!((_a = getChainById(chainId)) === null || _a === void 0 ? void 0 : _a.isLocalChain)) {\n            setLocalMulticallState(LocalMulticallState.NonLocal);\n        }\n        else if (multicallAddresses && multicallAddresses[chainId]) {\n            setLocalMulticallState(LocalMulticallState.Deployed);\n        }\n        else if (localMulticallState !== LocalMulticallState.Deploying) {\n            const signer = library.getSigner();\n            if (!signer) {\n                setLocalMulticallState(LocalMulticallState.Error);\n                return;\n            }\n            setLocalMulticallState(LocalMulticallState.Deploying);\n            const deployMulticall = async () => {\n                try {\n                    const { contractAddress, blockNumber } = await deployContract(multicallABI, signer);\n                    updateConfig({ multicallAddresses: { [chainId]: contractAddress } });\n                    setMulticallBlockNumber(blockNumber);\n                    setLocalMulticallState(LocalMulticallState.Deployed);\n                }\n                catch (_a) {\n                    setLocalMulticallState(LocalMulticallState.Error);\n                }\n            };\n            deployMulticall();\n        }\n    }, [library, chainId]);\n    const awaitingMulticallBlock = multicallBlockNumber && blockNumber && blockNumber < multicallBlockNumber;\n    if (localMulticallState === LocalMulticallState.Deploying ||\n        (localMulticallState === LocalMulticallState.Deployed && awaitingMulticallBlock)) {\n        return _jsx(\"div\", { children: \"Deploying multicall...\" });\n    }\n    else if (localMulticallState === LocalMulticallState.Error) {\n        return _jsx(\"div\", { children: \"Error deploying multicall contract\" });\n    }\n    else {\n        return _jsx(_Fragment, { children: children });\n    }\n}\n//# sourceMappingURL=LocalMulticallProvider.js.map"]},"metadata":{},"sourceType":"module"}